# 数据库表结构更新指南

## 问题说明

数据迁移工具报错"保存消息失败"，原因是数据库表缺少新增的字段。

## 解决方案（2种方法任选其一）

---

### 方法1：执行SQL更新脚本（推荐，5分钟）

#### 第1步：登录VPS MySQL

```bash
mysql -u root -p
# 输入密码：Fjcl123456@@
```

#### 第2步：复制执行以下SQL命令

```sql
USE chatapp;

-- 添加新字段
ALTER TABLE messages ADD COLUMN IF NOT EXISTS model_responses JSON NULL;
ALTER TABLE messages ADD COLUMN IF NOT EXISTS selected_model_id VARCHAR(255) NULL;
ALTER TABLE messages ADD COLUMN IF NOT EXISTS thinking_info JSON NULL;

-- 验证添加成功
DESCRIBE messages;
```

#### 第3步：退出MySQL

```sql
exit;
```

#### 第4步：测试迁移工具

访问：https://customized-business-assistant.vercel.app/admin/data-migration

重新导入数据，应该就成功了！

---

### 方法2：等待自动兼容（10分钟）

我已经更新了代码，即使数据库表没有新字段，也能正常导入（只保存基本字段）。

1. **等待Vercel自动部署完成**（约2-3分钟）
2. **刷新迁移页面**（Ctrl+F5）
3. **重新导入数据**

> 注意：使用此方法会丢失一些高级功能数据（多模型回复、思考链等），但聊天记录本身不会丢失。

---

## 验证成功

导入成功后，你会看到：

```
✅ 成功导入 XXX 条消息到VPS数据库！
```

然后：
1. 刷新首页（F5）
2. 查看左侧话题列表和历史消息是否都在

---

## 需要帮助？

如果还有问题，请提供：
1. 完整的错误截图
2. 浏览器F12控制台的错误信息

