# 🧪 数据迁移功能测试指南

## 测试目的

确保升级后的数据导出/导入功能能正常工作，包括新增的知识库和快捷短语功能。

---

## 📋 测试环境准备

### 所需环境
- ✅ 已安装并运行的应用
- ✅ 测试用的聊天记录
- ✅ 至少 1 个知识库和几个文档
- ✅ 至少几条自定义快捷短语

### 测试数据准备

如果没有测试数据，可以快速创建：

1. **创建测试聊天**
   - 发送 3-5 条测试消息
   - 创建 2-3 个不同的话题

2. **创建测试知识库**
   - 打开知识库设置
   - 创建 1 个知识库
   - 上传 2-3 个测试文档（可以是简单的文本文件）

3. **创建测试快捷短语**
   - 打开快捷短语设置
   - 添加 3-5 条测试短语

---

## ✅ 测试用例

### 测试 1：基本导出功能

**操作步骤**
```
1. 打开应用
2. 点击 "⚙️ 设置" → "💾 数据设置"
3. 查看数据概览
4. 点击 "导出备份文件"
```

**预期结果**
- ✅ 成功下载 JSON 文件
- ✅ 文件名格式：`chat-backup-YYYY-MM-DD.json`
- ✅ 显示成功提示：「数据导出成功」

**验证点**
```bash
# 使用文本编辑器打开导出的 JSON 文件，检查：
□ version 字段为 "1.1"
□ timestamp 字段有有效的时间戳
□ data.messages 数组存在且有数据
□ data.topics 数组存在
□ data.knowledgeBases 数组存在（新增）
□ data.quickPhrases 数组存在（新增）
□ data.settings 存在但不包含 apiKey
```

---

### 测试 2：数据完整性验证

**操作步骤**
```
1. 用文本编辑器打开导出的 JSON 文件
2. 验证各个字段的完整性
```

**预期结果**

#### messages 字段
```json
"messages": [
  {
    "id": "...",
    "content": "...",
    "role": "user",
    "timestamp": "2026-02-13T...",
    "topicId": "...",
    ...
  }
]
```

#### knowledgeBases 字段（新增）
```json
"knowledgeBases": [
  {
    "id": "kb_...",
    "name": "测试知识库",
    "embeddingModel": "...",
    "documents": [
      {
        "id": "doc_...",
        "name": "测试文档.txt",
        "content": "...",
        "uploadedAt": "2026-02-13T..."
      }
    ],
    "createdAt": "2026-02-13T...",
    "updatedAt": "2026-02-13T..."
  }
]
```

#### quickPhrases 字段（新增）
```json
"quickPhrases": [
  {
    "id": "...",
    "name": "测试短语",
    "content": "...",
    "category": "...",
    "createdAt": "2026-02-13T...",
    "updatedAt": "2026-02-13T..."
  }
]
```

**验证点**
```
□ 所有数组的长度与界面显示一致
□ 时间戳格式正确（ISO 8601）
□ 文档内容完整（不是截断的）
□ 没有包含 apiKey 字段
```

---

### 测试 3：基本导入功能

**操作步骤**
```
1. 在应用中创建一些新的测试数据（不同于导出时的数据）
2. 打开 "⚙️ 设置" → "💾 数据设置"
3. 点击 "选择备份文件恢复"
4. 选择之前导出的 JSON 文件
5. 在确认对话框中点击 "确定"
```

**预期结果**
- ✅ 显示导入确认对话框，包含正确的数据统计：
  ```
  即将导入以下数据：
  • X 条消息
  • X 个话题
  • X 个知识库    ← 检查这个
  • X 条快捷短语  ← 检查这个
  • 应用设置（不包括API Key）
  ```
- ✅ 点击确定后显示成功提示（持续 5 秒）
- ✅ 对话框自动关闭

**验证点**
```
□ 统计数字与导出时一致
□ 成功提示包含详细的恢复信息
□ 没有出现错误提示
```

---

### 测试 4：导入后数据验证

**操作步骤**
```
1. 导入完成后，检查各个功能模块
2. 验证数据是否正确恢复
```

**预期结果**

#### 聊天消息验证
```
□ 左侧话题列表显示正确
□ 点击话题，显示对应的聊天记录
□ 消息内容完整，没有乱码
□ 消息时间戳正确
```

#### 知识库验证
```
□ 打开 "📚 知识库" 设置
□ 知识库列表显示正确
□ 点击知识库，文档列表显示正确
□ 点击文档，可以查看内容
□ 文档状态显示正确
```

#### 快捷短语验证
```
□ 打开 "⚡ 快捷短语" 设置
□ 短语列表显示正确
□ 短语内容和分类正确
□ 可以正常使用短语
```

#### 其他验证
```
□ 智能体列表正确
□ 模型配置正确
□ Base URL 配置保留
```

---

### 测试 5：向后兼容性测试

**目的**: 验证新版本能否导入旧版本（v1.0）的备份文件

**操作步骤**
```
1. 准备一个 v1.0 格式的备份文件（没有 knowledgeBases 和 quickPhrases）
2. 尝试导入这个旧备份文件
```

**v1.0 格式示例**
```json
{
  "version": "1.0",
  "timestamp": "2026-02-13T...",
  "data": {
    "messages": [...],
    "agents": [...],
    "topics": [...],
    "settings": {...}
    // 没有 knowledgeBases
    // 没有 quickPhrases
  }
}
```

**预期结果**
- ✅ 能够成功导入
- ✅ 消息、话题、设置正常恢复
- ✅ 知识库和快捷短语保持当前状态（不被清空）
- ✅ 没有报错

---

### 测试 6：边界情况测试

#### 测试 6.1：空数据导出

**操作步骤**
```
1. 清空所有数据（或使用新安装的应用）
2. 尝试导出
```

**预期结果**
- ✅ 能够成功导出
- ✅ 各个数组为空数组 `[]`
- ✅ 没有报错

#### 测试 6.2：空数据导入

**操作步骤**
```
1. 导入一个空数据的备份文件
```

**预期结果**
- ✅ 能够成功导入
- ✅ 所有数据被清空
- ✅ 应用仍然可以正常使用

#### 测试 6.3：大文件导出/导入

**操作步骤**
```
1. 创建大量数据：
   - 100+ 条消息
   - 多个知识库，每个包含大文档
2. 导出数据
3. 导入数据
```

**预期结果**
- ✅ 导出不会超时
- ✅ 导入不会超时
- ✅ 文件大小合理（知识库文档会占大部分空间）
- ✅ 导入后数据完整

#### 测试 6.4：错误文件格式

**操作步骤**
```
1. 尝试导入非 JSON 文件（如 .txt 文件）
2. 尝试导入格式错误的 JSON 文件
3. 尝试导入没有 version 字段的 JSON 文件
```

**预期结果**
- ✅ 显示友好的错误提示
- ✅ 应用不会崩溃
- ✅ 现有数据不受影响

---

### 测试 7：多轮导出/导入测试

**目的**: 验证数据可以多次导出导入而不丢失

**操作步骤**
```
1. 导出备份文件 A
2. 修改一些数据
3. 导出备份文件 B
4. 导入备份文件 A（恢复到之前的状态）
5. 验证数据与第一次导出时一致
6. 导入备份文件 B（恢复到修改后的状态）
7. 验证数据与第二次导出时一致
```

**预期结果**
- ✅ 每次导入后数据与导出时一致
- ✅ 没有数据丢失或损坏
- ✅ 可以在不同版本之间来回切换

---

### 测试 8：跨设备测试（最重要！）

**目的**: 模拟春节回家的实际使用场景

**操作步骤**
```
设备 A（模拟公司电脑）：
1. 创建完整的测试数据
2. 导出备份文件
3. 将文件通过云盘/邮件传输到设备 B

设备 B（模拟家里电脑）：
1. 全新安装应用
2. 配置 API Key
3. 导入备份文件
4. 验证所有数据
5. 进行一些操作（发消息、创建话题等）
6. 导出新的备份文件
7. 将文件传回设备 A

设备 A：
1. 导入从设备 B 传回的备份文件
2. 验证在设备 B 上的操作都同步回来了
```

**预期结果**
- ✅ 所有数据在两台设备间准确传输
- ✅ 没有数据丢失
- ✅ 没有格式错误
- ✅ 可以继续工作

---

## 📊 测试报告模板

### 测试信息
```
测试日期：_____________
测试人员：_____________
应用版本：_____________
浏览器：_______________
操作系统：_____________
```

### 测试结果

| 测试编号 | 测试项目 | 结果 | 备注 |
|---------|---------|------|------|
| 1 | 基本导出功能 | ☐ 通过 ☐ 失败 | |
| 2 | 数据完整性验证 | ☐ 通过 ☐ 失败 | |
| 3 | 基本导入功能 | ☐ 通过 ☐ 失败 | |
| 4 | 导入后数据验证 | ☐ 通过 ☐ 失败 | |
| 5 | 向后兼容性测试 | ☐ 通过 ☐ 失败 | |
| 6.1 | 空数据导出 | ☐ 通过 ☐ 失败 | |
| 6.2 | 空数据导入 | ☐ 通过 ☐ 失败 | |
| 6.3 | 大文件导出/导入 | ☐ 通过 ☐ 失败 | |
| 6.4 | 错误文件格式 | ☐ 通过 ☐ 失败 | |
| 7 | 多轮导出/导入 | ☐ 通过 ☐ 失败 | |
| 8 | 跨设备测试 | ☐ 通过 ☐ 失败 | |

### 发现的问题

```
问题 1：
描述：_____________________________
重现步骤：_________________________
严重程度：☐ 致命 ☐ 严重 ☐ 一般 ☐ 轻微

问题 2：
...
```

### 总体评价

```
□ 所有测试通过，可以交付
□ 部分测试失败，需要修复
□ 大量测试失败，需要重新开发
```

---

## 🐛 常见问题排查

### 导出失败

**症状**: 点击导出按钮没有反应

**检查**:
1. 打开浏览器控制台（F12），查看是否有错误
2. 检查是否有数据（数据统计显示是否为 0）
3. 尝试刷新页面后再试

### 导入失败

**症状**: 导入时提示错误

**检查**:
1. 确认文件格式是 JSON
2. 用文本编辑器打开文件，检查 JSON 格式是否正确
3. 确认文件大小不是 0
4. 尝试用在线 JSON 验证工具验证文件

### 导入后数据不显示

**症状**: 导入成功但看不到数据

**检查**:
1. 刷新页面（F5）
2. 检查是否选择了正确的话题/智能体
3. 打开浏览器控制台查看是否有错误
4. 检查 localStorage 是否有数据（开发者工具 → Application → Local Storage）

---

## ✅ 测试完成清单

测试完成后，确认：

```
□ 所有核心功能测试通过
□ 至少完成一次跨设备测试
□ 记录了所有发现的问题
□ 准备好用户文档
□ 培训材料已准备（如需要）
```

---

**祝测试顺利！** 🎉

有问题请参考：
- 《春节回家办公-数据迁移指南.md》
- 《春节数据迁移功能升级说明.md》



