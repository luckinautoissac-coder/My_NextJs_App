# 🔒 安全架构说明

## 📋 概述

重新设计了应用架构，将所有敏感的智能体提示词移至后端保护，确保客户无法查看您的核心提示词。

## 🏗️ 架构变更

### ❌ 之前的不安全架构
```
前端 → 直接调用 AIHUBMIX API
├── 智能体配置存储在前端
├── 系统提示词暴露在浏览器
└── 客户可通过开发者工具查看提示词
```

### ✅ 现在的安全架构
```
前端 → Next.js API 路由 → AIHUBMIX API
├── 智能体配置存储在服务端
├── 系统提示词完全隐藏
└── 客户只能看到智能体名称和描述
```

## 🔧 技术实现

### 1. 后端API接口 (`/api/chat`)

**文件位置**: `src/app/api/chat/route.ts`

**功能**:
- 接收前端的聊天请求
- 根据智能体ID获取对应的系统提示词
- 调用AIHUBMIX API
- 返回AI回复给前端

**受保护的智能体配置**:
```typescript
const PROTECTED_AGENTS = {
  'general-assistant': {
    name: '通用助手',
    description: '我是一个友善、有用的AI助手',
    systemPrompt: '你是一个友善、有用的AI助手...' // 🔒 完全隐藏
  },
  'programming-expert': {
    name: '编程专家', 
    description: '专业的编程和技术顾问',
    systemPrompt: '你是一个资深的软件开发工程师...' // 🔒 完全隐藏
  }
  // ... 更多智能体
}
```

### 2. 前端API调用

**文件位置**: `src/lib/api.ts`

**变更**:
- 移除直接调用AIHUBMIX API
- 改为调用本地 `/api/chat` 接口
- 只传递消息内容、智能体ID和API Key
- **不再传递系统提示词**

### 3. 智能体管理

**文件位置**: `src/store/agentStore.ts`

**变更**:
- 智能体列表从服务端获取
- 前端只存储智能体ID、名称、描述
- **完全移除系统提示词字段**
- 移除前端编辑智能体功能

### 4. 用户界面

**文件位置**: `src/components/sidebar/AgentSidebar.tsx`

**变更**:
- 移除智能体编辑/删除功能
- 移除"添加智能体"按钮
- 只显示服务端提供的智能体列表
- 添加刷新按钮获取最新智能体

## 🔐 安全特性

### ✅ 提示词保护
- **服务端存储**: 所有系统提示词存储在服务端
- **前端隐藏**: 前端代码中完全没有提示词
- **API封装**: 通过后端API调用，提示词不经过前端

### ✅ 客户端限制
- **只读访问**: 客户只能查看智能体名称和描述
- **无编辑权限**: 无法修改或查看系统提示词
- **受控选择**: 只能从预定义的智能体中选择

### ✅ 数据传输安全
- **最小化传输**: 只传输必要的数据（消息、智能体ID、API Key）
- **服务端处理**: 所有敏感逻辑在服务端执行
- **结果返回**: 只返回AI回复结果

## 🎯 客户体验

### 对客户的影响
- **使用体验不变**: 聊天功能完全正常
- **界面简洁**: 移除了复杂的编辑功能
- **专业感**: 展示精心设计的智能体

### 对您的好处
- **IP保护**: 核心提示词完全保密
- **品牌控制**: 客户只看到您希望展示的内容
- **商业安全**: 防止提示词被复制或逆向工程

## 🚀 如何添加新智能体

### 1. 编辑服务端配置
在 `src/app/api/chat/route.ts` 中的 `PROTECTED_AGENTS` 对象添加新智能体：

```typescript
const PROTECTED_AGENTS = {
  // ... 现有智能体
  'your-new-agent': {
    name: '新智能体名称',
    description: '客户看到的描述',
    systemPrompt: '您的核心提示词...' // 🔒 完全保密
  }
}
```

### 2. 重启应用
```bash
npm run dev
```

### 3. 客户端自动更新
- 客户端会自动获取新的智能体列表
- 无需修改前端代码
- 新智能体立即可用

## 📊 对比总结

| 特性 | 之前 | 现在 |
|------|------|------|
| 提示词存储 | ❌ 前端暴露 | ✅ 服务端保护 |
| 客户访问权限 | ❌ 可查看提示词 | ✅ 只能看描述 |
| 编辑功能 | ❌ 客户可编辑 | ✅ 服务端控制 |
| IP保护 | ❌ 无保护 | ✅ 完全保密 |
| 部署复杂度 | ✅ 简单 | ✅ 仍然简单 |
| 用户体验 | ✅ 良好 | ✅ 更专业 |

## 🎉 总结

现在您的智能体提示词完全安全，客户无法通过任何方式查看或获取您的核心IP。同时保持了良好的用户体验和专业的界面设计。

**您的商业秘密现在完全受到保护！** 🔒✨