# 💰 充值后无法使用问题排查指南

## 问题描述
客户在 AIHUBMIX 充值后，发送消息给智能体没有任何反应，AI 不回复。

---

## ✅ 标准解决流程

### 第一步：等待余额同步（最重要！）

充值后需要 **1-2 分钟** 系统才能同步余额到 API。

**请按照以下步骤操作：**

1. 充值完成后，**等待 2 分钟**
2. 不要立即测试，让系统有时间同步
3. 2 分钟后再继续下一步

---

### 第二步：使用连接诊断工具

应用现在内置了专业的诊断工具，无需清除任何数据：

1. 打开应用
2. 点击右上角 **设置（齿轮图标）**
3. 切换到 **"连接诊断"** 标签页
4. 点击 **"开始诊断"** 按钮
5. 查看诊断结果

**诊断工具会自动检测：**
- ✅ API Key 是否配置
- ✅ 网络连接是否正常
- ✅ 账户余额是否充足
- ✅ 模型是否可用

**根据诊断结果操作：**
- 如果显示"余额不足"：说明充值还未生效，再等待 1-2 分钟后重新诊断
- 如果显示"API Key 无效"：需要重新生成 API Key（见第三步）
- 如果显示"所有检查通过"：说明已经可以正常使用了

---

### 第三步：重新生成 API Key（如果诊断显示无效）

如果诊断工具显示 API Key 无效，请执行以下操作：

1. 登录 [AIHUBMIX 官网](https://aihubmix.com)
2. 进入"API 管理"页面
3. **删除旧的 API Key**
4. **生成新的 API Key**
5. 复制新的 API Key
6. 在应用设置中更新 API Key
7. 保存设置
8. 再次运行连接诊断

---

### 第四步：验证功能

1. 在诊断工具中点击"开始诊断"
2. 确认显示 **"所有检查通过"**
3. 关闭设置
4. 选择或创建一个智能体
5. 创建新话题
6. 发送测试消息："你好"
7. 等待 AI 回复

---

## 🔍 常见问题详解

### Q1: 为什么充值后需要等待？
**A:** AIHUBMIX 的充值系统和 API 系统是分开的，充值后需要时间同步到 API 账户。通常需要 1-2 分钟，高峰期可能需要 3-5 分钟。

### Q2: 我等了 5 分钟还是不行怎么办？
**A:** 
1. 先运行连接诊断工具查看具体错误
2. 如果显示余额不足，可能是充值未到账，联系 AIHUBMIX 客服
3. 如果显示 API Key 无效，按照第三步重新生成

### Q3: 是否需要清除浏览器缓存？
**A:** **不需要！** 本应用的缓存用于保存对话历史和客户数据，清除缓存会丢失这些重要信息。充值问题与浏览器缓存无关。

### Q4: 重新生成 API Key 会影响其他应用吗？
**A:** 是的，旧的 API Key 会立即失效。如果您在多个地方使用同一个 API Key，都需要更新为新的 Key。

### Q5: 诊断工具会消耗我的 API 额度吗？
**A:** 不会。诊断测试使用的是最小化请求，几乎不消耗额度。

---

## 📊 错误代码对照表

| 错误信息 | 原因 | 解决方案 |
|---------|------|---------|
| "API Key 无效或已过期" | API Key 错误 | 重新生成新的 API Key |
| "账户余额不足" | 充值未生效或余额为0 | 等待 2 分钟后重新诊断；或确认充值是否成功 |
| "请求过于频繁" | 短时间内测试太多次 | 等待 2 分钟后重试 |
| "网络连接失败" | 网络问题 | 检查网络，关闭 VPN |
| "API 返回格式异常" | 服务端问题 | 联系技术支持 |

---

## 🎯 快速检查清单

在联系技术支持前，请确认以下事项：

- [ ] 充值后已等待至少 2 分钟
- [ ] 已运行连接诊断工具
- [ ] API Key 是从 AIHUBMIX 官网复制的（不是随意输入）
- [ ] 在 AIHUBMIX 官网能看到充值记录
- [ ] 在 AIHUBMIX 官网能看到账户余额
- [ ] 尝试过重新生成 API Key
- [ ] 网络连接正常，能访问 AIHUBMIX 官网

---

## 🆘 联系技术支持

如果按照以上步骤操作后问题仍未解决，请准备以下信息联系技术支持：

1. **诊断工具的截图**（显示具体错误信息）
2. **AIHUBMIX 账户余额截图**（证明已充值）
3. **充值时间**（精确到分钟）
4. **当前测试时间**（精确到分钟）
5. **使用的浏览器和版本**

**重要提示：** 不要分享您的完整 API Key，只需提供前 8 位字符即可（例如：sk-xxxxx...）

---

## 🔧 技术说明（给开发者）

### 为什么不清除缓存？

1. **业务需求**：缓存中存储了客户对话历史，用于客户跟踪和服务分析
2. **问题无关**：充值问题是 API 服务端的余额同步问题，与客户端缓存无关
3. **数据保护**：清除缓存会丢失所有 localStorage 数据，包括重要的业务数据

### 诊断工具的作用

诊断工具直接调用 API 接口，可以实时检测：
- API Key 是否有效
- 账户余额状态
- 网络连接质量
- 服务端响应状态

这比简单的"发送消息测试"更准确，能快速定位问题根源。

### API 响应缓存

应用不会缓存 API 的错误响应，每次请求都是实时的。因此充值生效后，立即就能正常使用，无需任何操作。

